# 随机变量函数的期望求导
### 连续型变量
记\(g(X)\)是关于连续随机变量\(X\)的函数，它的期望表达式如下：
\[E[g(x, X)] = \int_{-\infty}^{+\infty}g(x, t)f(t)dt\]
记\(F(x) = \int_{-\infty}^{+\infty} g(x, t) \cdot f(t)dt\)，有：
\[F(x + \Delta x) = \int_{-\infty}^{+\infty} g(x + \Delta x, t) \cdot f(t)dt\]利用积分的线性可加性：
\[F(x + \Delta x) - F(x) = \int_{-\infty}^{+\infty} [g(x + \Delta x, t) - g(x, t)] \cdot f(t)dt\]
如果**极限和积分可以调换位置**，那么我们可以将极限式先于积分式进行计算, 因此：
\[\begin{aligned}
F'(x) &= \lim_{\Delta x \to 0} \frac{F(x + \Delta x) - F(x)}{\Delta x} \\
&= \lim_{\Delta x \to 0} \frac{\int_{-\infty}^{+\infty} [g(x + \Delta x, t) - g(x, t)] \cdot f(t)dt}{\Delta x} \\
&= \int_{-\infty}^{+\infty} \lim_{\Delta x \to 0} \frac{g(x + \Delta x, t) - g(x, t)}{\Delta x} f(t)dt \\
&= \int_{-\infty}^{+\infty} g'(x, t)f(t)dt \\
&= E(g'(t))
\end{aligned}\]
可以看到，在能交换积分和极限顺序的情况下，
\[E[g(x, X)]' = E(g'(x, X))\]

然而，是否能交换积分和极限顺序是一个很复杂的问题。至少是一个极其数学化的问题了！

-------------------

### 离散型变量
记\(g(X)\)是关于离散随机变量\(X\)的函数，它的期望表达式如下：
\[E(g(x, X)) = \sum_{i=1}^{\infty} g(x, i) p(X = i)\]
记\(F(x) = E(g(x, X))\)
仿照连续性变量。当该离散型变量的取值有限时：
\[\begin{aligned}
F'(x) &= \lim_{\Delta x \to 0} \sum_{i=1}^n \frac{[g(x+\Delta x, i) - g(x, i)]p(X = i)}{\Delta x} \\
&= \sum_{i=1}^n p(X = i) \cdot \lim_{\Delta x \to 0} \frac{[g(x+\Delta x, i) - g(x, i)]}{\Delta x} \\
&= \sum_{i=1}^n g'(x, i) \cdot p(X = i) \\
&= E(g'(x, X))
\end{aligned}\]

离散型变量交换求和和极限的顺序的条件相对较弱。这源于**有限和的导数等于导数的有限和**，即：
\[F(x) = a_1(x) + a_2(x) + ... + a_n(x) \implies \\ F'(x) = a_1'(x) + a_2'(x) + ... + a_n'(x)\]
具体条件如下：
- 若\(X\)的取值是有限的，可以直接交换
- 若X的取值是无限的（如泊松分布、几何分布），则需满足 “导数序列一致收敛”。无限求和类似积分，要保证"**一致收敛性**"。这也是有限和无限的特殊分割线。