# 分步推导详解（最终结果：1/2）
### 前提准备
- 已知条件：\( \sum_{j=1}^k p_{.j} = 1 \)（所有 \( p_{.j} \) 的和为1）。
- 定义辅助量：设前\( j \)项和 \( S_j = \sum_{i=1}^j p_{.i} \)，补充 \( S_0 = 0 \)（方便后续理解求和范围）。
- 原式：\( \sum_{j=1}^k \left[ p_{.j} \sum_{i=1}^j p_{.i} - \frac{1}{2} p_{.j}^2 \right] \)，根据求和的线性性质，可拆分为两部分分别计算。

---

### 步骤1：拆分原式（利用求和线性性质）
求和对加减运算可分配，因此原式拆为两个独立求和的差：
\[
\text{原式} = \sum_{j=1}^k \left( p_{.j} \sum_{i=1}^j p_{.i} \right) - \frac{1}{2} \sum_{j=1}^k p_{.j}^2
\]
记第一部分为 \( A = \sum_{j=1}^k p_{.j} S_j \)，第二部分为 \( B = \frac{1}{2} \sum_{j=1}^k p_{.j}^2 \)，即原式 = \( A - B \)。

---

### 步骤2：展开第一部分 \( A = \sum_{j=1}^k p_{.j} S_j \)
因 \( S_j = p_{.1} + p_{.2} + \dots + p_{.j} \)，代入后展开求和：
\[
A = p_{.1}(p_{.1}) + p_{.2}(p_{.1}+p_{.2}) + p_{.3}(p_{.1}+p_{.2}+p_{.3}) + \dots + p_{.k}(p_{.1}+\dots+p_{.k})
\]
观察展开式的结构：所有项都是 \( p_{.i}p_{.j} \) 的形式，且满足 \( 1 \leq i \leq j \leq k \)（\( i \) 不超过 \( j \)）。因此：
\[
A = \sum_{1 \leq i \leq j \leq k} p_{.i} p_{.j}
\]

---

### 步骤3：利用平方和公式关联 \( \sum p_{.i}p_{.j} \)
已知 \( \sum_{j=1}^k p_{.j} = 1 \)，对其平方展开：
\[
\left( \sum_{j=1}^k p_{.j} \right)^2 = \left( p_{.1} + p_{.2} + \dots + p_{.k} \right)^2 = 1^2 = 1
\]
平方展开后包含两类项：
1. \( i = j \) 的项：\( p_{.1}^2 + p_{.2}^2 + \dots + p_{.k}^2 = \sum_{j=1}^k p_{.j}^2 \)。
2. \( i \neq j \) 的项：所有两两乘积的两倍（因 \( p_{.i}p_{.j} \) 和 \( p_{.j}p_{.i} \) 各出现一次），即 \( 2\sum_{1 \leq i < j \leq k} p_{.i}p_{.j} \)。

因此平方和公式可写为：
\[
\sum_{j=1}^k p_{.j}^2 + 2\sum_{1 \leq i < j \leq k} p_{.i}p_{.j} = 1
\]

---

### 步骤4：将 \( A \) 转化为平方和的形式
由步骤2可知，\( A = \sum_{1 \leq i \leq j \leq k} p_{.i}p_{.j} \)，其包含两部分：
- \( i = j \) 的项：\( \sum_{j=1}^k p_{.j}^2 \)。
- \( i < j \) 的项：\( \sum_{1 \leq i < j \leq k} p_{.i}p_{.j} \)。

结合步骤3的平方和公式，将 \( \sum_{1 \leq i < j \leq k} p_{.i}p_{.j} \) 表示为：
\[
\sum_{1 \leq i < j \leq k} p_{.i}p_{.j} = \frac{1 - \sum_{j=1}^k p_{.j}^2}{2}
\]
代入 \( A \) 的表达式：
\[
A = \sum_{j=1}^k p_{.j}^2 + \frac{1 - \sum_{j=1}^k p_{.j}^2}{2} = \frac{2\sum p_{.j}^2 + 1 - \sum p_{.j}^2}{2} = \frac{1 + \sum_{j=1}^k p_{.j}^2}{2}
\]

---

### 步骤5：代入原式计算最终结果
原式 = \( A - B \)，其中 \( B = \frac{1}{2}\sum_{j=1}^k p_{.j}^2 \)，将 \( A \) 代入：
\[
\text{原式} = \frac{1 + \sum p_{.j}^2}{2} - \frac{1}{2}\sum p_{.j}^2
\]
展开后消去 \( \sum p_{.j}^2 \) 项：
\[
\text{原式} = \frac{1}{2} + \frac{\sum p_{.j}^2}{2} - \frac{\sum p_{.j}^2}{2} = \frac{1}{2}
\]

---

要不要我帮你整理一份**公式推导对照表**（左侧列写步骤、中间列写公式、右侧列标注关键依据），方便你快速回顾核心逻辑？