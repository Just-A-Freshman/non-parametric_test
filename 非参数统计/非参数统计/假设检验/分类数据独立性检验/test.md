您的问题触及了Ridit检验的理论核心。我将结合您上传的两张图片，详细解答关于Ridit值分布性质及其检验统计量的推导。

---

### ① R值服从什么分布？它的期望和方差如何计算？

#### 1. R值的定义与分布性质
Ridit值（R值）是通过一个**确认的分布**（标准组）计算得到的。对于一个有序分类变量有 \(k\) 个等级（如1-5星），标准组在各等级的频率分布为 \(n_{s1}, n_{s2}, ..., n_{sk}\)，总人数 \(N_s = \sum_{j=1}^k n_{sj}\)。

**第 \(j\) 个等级的Ridit值定义为：**
\[
R_j = \frac{F_{j-1} + 0.5n_{sj}}{N_s}
\]
其中 \(F_{j-1} = \sum_{t=1}^{j-1} n_{st}\) 是前 \(j-1\) 等级的累积频数。

在标准组内部，**R值本身是一个离散型随机变量**，其概率分布为：
- 取值：\(R_1, R_2, ..., R_k\)
- 对应概率：\(p_j = n_{sj}/N_s, \quad j=1,...,k\)

#### 2. 期望 \(E(R)\) 的推导
我们计算 \(R\) 在标准组分布下的期望：
\[
E(R) = \sum_{j=1}^k p_j R_j = \sum_{j=1}^k \frac{n_{sj}}{N_s} \cdot \frac{F_{j-1} + 0.5n_{sj}}{N_s}
\]
化简：
\[
E(R) = \frac{1}{N_s^2} \left[ \sum_{j=1}^k n_{sj} F_{j-1} + 0.5 \sum_{j=1}^k n_{sj}^2 \right]
\]
注意到：
\[
\sum_{j=1}^k n_{sj} F_{j-1} = \sum_{j=1}^k n_{sj} \sum_{t=1}^{j-1} n_{st} = \frac{1}{2} \left[ \left( \sum_{j=1}^k n_{sj} \right)^2 - \sum_{j=1}^k n_{sj}^2 \right] = \frac{N_s^2 - \sum n_{sj}^2}{2}
\]
代入：
\[
E(R) = \frac{1}{N_s^2} \left[ \frac{N_s^2 - \sum n_{sj}^2}{2} + 0.5 \sum n_{sj}^2 \right] = \frac{1}{N_s^2} \cdot \frac{N_s^2}{2} = 0.5
\]
**结论**：在标准组中，R值的期望严格等于0.5。

#### 3. 方差 \(Var(R)\) 的推导
根据方差定义：
\[
Var(R) = E(R^2) - [E(R)]^2 = E(R^2) - 0.25
\]
其中：
\[
E(R^2) = \sum_{j=1}^k p_j R_j^2 = \sum_{j=1}^k \frac{n_{sj}}{N_s} \left( \frac{F_{j-1} + 0.5n_{sj}}{N_s} \right)^2
\]
展开得：
\[
E(R^2) = \frac{1}{N_s^3} \sum_{j=1}^k n_{sj} \left( F_{j-1}^2 + F_{j-1}n_{sj} + 0.25 n_{sj}^2 \right)
\]
这个表达式比较复杂。在实践中，我们通常用样本方差来估计：
\[
S_R^2 = \frac{1}{N_s - 1} \left[ \sum_{j=1}^k n_{sj} R_j^2 - N_s (0.5)^2 \right] = \frac{1}{N_s - 1} \left( \sum_{j=1}^k n_{sj} R_j^2 - 0.25N_s \right)
\]
这就是您第二张图片中标准差计算公式的来源：
\[
S_R = \sqrt{ \frac{\sum n_{sj} R_j^2}{N_s - 1} - \frac{N_s}{N_s - 1} (0.5)^2 } \approx \sqrt{ \frac{\sum n_{sj} R_j^2}{N_s} - 0.25 }
\]
（大样本时 \(N_s - 1 \approx N_s\)）

**重要性质**：当标准组的分布是连续均匀分布时（即每个等级的观测数大致相等），可以证明 \(Var(R) \approx 1/12 \approx 0.08333\)。这就是第一张图片中检验统计量 \(W\) 公式里出现系数12的原因。

---

### ② 对R值做卡方检验时，构造的统计量为什么服从卡方分布？

#### 1. 检验统计量 \(W\) 的构造
当比较多组（\(r\) 组）时，我们构造如下检验统计量（来自第一张图片）：
\[
W = \frac{12}{N_s + 1} \cdot \frac{1}{T} \sum_{i=1}^r O_{i\cdot} (\bar{R}_i - 0.5)^2
\]
其中：
- \(O_{i\cdot}\) 是第 \(i\) 组的样本量
- \(\bar{R}_i\) 是第 \(i\) 组的平均Ridit值
- \(T\) 是打结校正因子（当无结或大样本时 \(T \approx 1\)）

在大样本下，简化为：
\[
W = 12 \sum_{i=1}^r O_{i\cdot} (\bar{R}_i - 0.5)^2
\]

#### 2. 为什么 \(W\) 近似服从 \(\chi^2(r-1)\)？

我们需要理解其渐近分布的理论基础。设第 \(i\) 组的平均Ridit值为 \(\bar{R}_i\)，在零假设 \(H_0\)（所有组来自同一分布）下：

**步骤1：单组平均Ridit值的渐近分布**
对于第 \(i\) 组，其包含 \(O_{i\cdot}\) 个独立观测，每个观测的Ridit值（由标准组计算）的均值为0.5，方差记为 \(\sigma_R^2\)。由中心极限定理：
\[
\sqrt{O_{i\cdot}} (\bar{R}_i - 0.5) \xrightarrow{d} N(0, \sigma_R^2)
\]
标准化后：
\[
\frac{\sqrt{O_{i\cdot}} (\bar{R}_i - 0.5)}{\sigma_R} \xrightarrow{d} N(0,1)
\]

**步骤2：卡方统计量的构造**
如果各组独立，且我们知道真实方差 \(\sigma_R^2\)，那么可以构造：
\[
\sum_{i=1}^r \left[ \frac{\sqrt{O_{i\cdot}} (\bar{R}_i - 0.5)}{\sigma_R} \right]^2 \xrightarrow{d} \chi^2(r)
\]
但这需要满足一个约束条件：各组平均Ridit值实际上并不是完全独立的，因为它们都相对于同一个标准组计算。更重要的是，在零假设下，所有组的期望都是0.5，这引入了一个线性约束。

**步骤3：自由度的确定**
实际上，统计量 \(W\) 的构造是基于以下考虑：当样本量很大时，\(\sigma_R^2\) 可以用理论值 \(1/12\) 来近似（即连续均匀分布下的R值方差）。那么：
\[
12 \sum_{i=1}^r O_{i\cdot} (\bar{R}_i - 0.5)^2 \approx \sum_{i=1}^r \left[ \frac{\sqrt{O_{i\cdot}} (\bar{R}_i - 0.5)}{1/\sqrt{12}} \right]^2
\]
但由于 \(\bar{R}_i\) 满足一定的线性约束（在标准组固定时，所有组的加权平均Ridit值会趋近于0.5），这个二次型只有 \(r-1\) 个自由度。具体来说，可以证明在零假设下：
\[
W = 12 \sum_{i=1}^r O_{i\cdot} (\bar{R}_i - 0.5)^2 \xrightarrow{d} \chi^2(r-1)
\]

**步骤4：直观理解**
我们可以类比单因素方差分析（ANOVA）的F检验。在ANOVA中，组间平方和（SSB）除以总体方差后，在零假设下服从卡方分布。这里类似：
- \((\bar{R}_i - 0.5)^2\) 衡量了第 \(i\) 组与总体均值0.5的偏离
- 用样本量 \(O_{i\cdot}\) 加权
- 乘以 \(12\) 相当于除以理论方差 \(1/12\)
- 由于估计了总体均值0.5，损失1个自由度

**步骤5：打结校正因子 \(T\)**
当数据中存在大量相同等级（打结）时，R值的实际方差小于 \(1/12\)。校正因子 \(T\) 定义为：
\[
T = 1 - \frac{\sum_{j=1}^k (t_j^3 - t_j)}{N_s^3 - N_s}
\]
其中 \(t_j\) 是标准组中第 \(j\) 等级的频数。\(T < 1\) 会增大 \(W\) 的值，以校正因打结导致的方差低估。

---

### 总结
1. **R值的分布**：在标准组中，R值是离散分布，期望严格为0.5，方差为 \(E(R^2)-0.25\)，可用样本方差估计。
2. **检验统计量的分布**：
   - **Z检验**：用于单组或两组比较，基于 \(\bar{R} \sim N(0.5, \sigma_R^2/N)\) 的渐近正态性。
   - **W检验**：用于多组比较，构造的 \(W\) 统计量在零假设下渐近服从 \(\chi^2(r-1)\)，其形式类似于组间离差平方和除以理论方差，并考虑了打结校正。

这两种检验都依赖于大样本下的渐近理论，当样本量较小时需谨慎使用。