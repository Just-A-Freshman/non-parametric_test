您好！您提出的问题实际上是概率论中经典的“优惠券收集问题”（Coupon Collector Problem）。我将从初等概率论的角度，基于几何分布的概念，逐步推导出期望值的公式。推导过程会从简单情形开始，逐步推广到一般情形。

### 问题重述
假设每次操作从数字 \(1, 2, \ldots, n\) 中以等概率（即每个数字出现的概率为 \(1/n\)）随机输出一个数。我们需要计算直到所有 \(n\) 个数字都至少出现一次所需操作次数的期望值，记作 \(E_n\)。

### 推导思路
关键思路是将收集过程分解为多个阶段：从收集第一个新数字开始，到收集第二个新数字，直至收集第 \(n\) 个新数字。每个阶段的等待时间都服从几何分布，因此总期望是各个阶段期望之和。

- 定义 \(T_k\) 为从已经收集到 \(k-1\) 个不同数字后，到收集到第 \(k\) 个新数字所需的操作次数（其中 \(k = 1, 2, \ldots, n\)）。注意，当 \(k=1\) 时，表示收集第一个数字的等待时间。
- 总操作次数 \(T = T_1 + T_2 + \cdots + T_n\)，因此期望为 \(E_n = E[T] = E[T_1] + E[T_2] + \cdots + E[T_n]\)。

现在，我们分析每个 \(T_k\) 的期望。

#### 阶段期望计算
- 当已经收集了 \(k-1\) 个数字时，每次操作得到一个新数字的概率是：
  \[
  p_k = \frac{n - (k-1)}{n} = \frac{n - k + 1}{n}
  \]
  因为还有 \(n - k + 1\) 个数字未收集。
- \(T_k\) 服从几何分布：成功概率为 \(p_k\)，因此期望为：
  \[
  E[T_k] = \frac{1}{p_k} = \frac{n}{n - k + 1}
  \]

#### 总期望求和
将各个阶段的期望相加：
\[
E_n = \sum_{k=1}^{n} E[T_k] = \sum_{k=1}^{n} \frac{n}{n - k + 1}
\]
为了简化求和，令索引 \(i = n - k + 1\)。当 \(k=1\) 时，\(i=n\)；当 \(k=n\) 时，\(i=1\)。因此求和变为：
\[
E_n = \sum_{i=1}^{n} \frac{n}{i} = n \sum_{i=1}^{n} \frac{1}{i}
\]
其中 \(\sum_{i=1}^{n} \frac{1}{i}\) 是第 \(n\) 个调和数（Harmonic number），记作 \(H_n\)：
\[
H_n = 1 + \frac{1}{2} + \frac{1}{3} + \cdots + \frac{1}{n}
\]
因此，最终公式为：
\[
E_n = n H_n = n \left(1 + \frac{1}{2} + \frac{1}{3} + \cdots + \frac{1}{n}\right)
\]

### 简单情形验证
- **当 \(n=1\)**：只有一个数字，一次操作即可完成。期望 \(E_1 = 1 \times H_1 = 1 \times 1 = 1\)，符合。
- **当 \(n=2\)**：收集第一个数字的期望 \(E[T_1] = 1\)；收集第二个数字时，成功概率为 \(1/2\)，期望 \(E[T_2] = 2\)。总期望 \(E_2 = 1 + 2 = 3\)。而公式 \(E_2 = 2 H_2 = 2 \left(1 + \frac{1}{2}\right) = 2 \times 1.5 = 3\)，符合。
- **当 \(n=3\)**：公式给出 \(E_3 = 3 H_3 = 3 \left(1 + \frac{1}{2} + \frac{1}{3}\right) = 3 \times \frac{11}{6} = 5.5\)。可以验证：阶段期望分别为 \(E[T_1]=1\)，\(E[T_2]=3/2=1.5\)（因为 \(p_2=2/3\)，期望 \(3/2\)），\(E[T_3]=3\)（因为 \(p_3=1/3\)，期望 \(3\)），总和 \(1 + 1.5 + 3 = 5.5\)，符合。

### 结论
因此，得到从 \(1\) 到 \(n\) 中所有数所需操作次数的期望值为：
\[
\boxed{E_n = n H_n = n \sum_{i=1}^{n} \frac{1}{i}}
\]
这个结果清晰地展示了期望与调和数的关系，其中几何分布的概念在推导中起到了核心作用。如果您有更多问题或需要进一步解释，请随时告知！