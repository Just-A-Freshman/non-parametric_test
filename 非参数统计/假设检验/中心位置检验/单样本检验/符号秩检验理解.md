## 1、目标简述
符号秩检验是对符号检验的改进。因为符号检验只考虑了方向而忽略大小，例如样本数据，
\[data = \{-10, -9, -8, -6, 1, 2, 3, 4\}\]
我们是否能说\(\theta = 0\)是\(data\)服从的总体分布的中位数呢？根据符号检验，由于\(S^+\)和\(S^-\)接近，其通过符号检验是必然的。然而，从直觉上看，这个0并不是一个"优秀"的中位数，我们能明显感觉到0左侧的数距离更远，给人一种左高右低的感觉。

事实上，无论是对于离散分布还是连续分布，它们的中位数都不是唯一的。上述例子中，data的中位数可以取(-6, 1)之间任意一个值；而对于连续分布，只要\(\theta\)满足\(F(\theta) = 0.5\)就能是中位数。而\(F(x)\)是单调非减函数。只要存在\(\epsilon > 0, 使得F(\theta + \epsilon) = F(\theta) = 0.5\)，那么在\((\theta, \theta + \epsilon)\)内的任意一个数都能是这个连续分布的中位数。

正因如此，我们希望\(\theta\)不仅是中位数，还要满足：**\(\theta\)两端数据疏密程度相当**。它可以进一步翻译成：\(\theta\)左侧的数值距离总和与右侧的数值距离总和接近。

特别的，在非参中我们表达数值大小时不依赖数值的真实大小，而是用秩来替代。这是因为秩不依赖于数据的实际概率分布。设\(y_j = x_j - \theta\)。我们将上面的想法用数学语言表述就是：
\[
W^+ = \sum_{j=1}^n R(|y_j|) * I(y_j > 0) \\
W^- =  \sum_{j=1}^n R(|y_j|) * I(y_j < 0) \\
\]
因此，我们的初步想法是要求\(|W^+ - W^-| \leq c\)。其中，\(R(|y_j|)\)表示\(|y_j|\)在序列\(\{|y_1|, |y_2|, ..., |y_n|\}\)中的秩；\(I(.)\)为示性函数。



## 2、概念引入
#### (1)Wilcox符号秩检验统计量及其拒绝域
在开始前，我们从序列中剔除\(x_j = \theta\)的数据。剔除后样本量\(n' \leq n\)。为方便起见，我们仍然使用\(n\)作为清洗后的样本量。
在\(H_0: M_e = \theta\)的情况下，我们发现：
\[W^+ + W^- = \sum\limits_{j=1}^n R(|y_j|) = \frac{(1 + n)n}{2}\]
因此，由接受域\(|W^+ - W^-| \leq c\)，可以推出拒绝域为\(|W^+ - W^-| > c\)，它等价于：
\[\left|W^+ - \frac{(1+n)n}{4}\right| > c' \, 或 \left|W^- - \frac{(1+n)n}{4}\right| > c' \]
##### ①当\(W^+ > W^-\)时
去除绝对值可得：
\[\left|W^+ - \frac{(1+n)n}{4}\right| = W^+ - \frac{(1+n)n}{4}\]
\[\left|W^- - \frac{(1+n)n}{4}\right| = \frac{(1+n)n}{4} - W^-\]
故拒绝域的形式为：\(W^+ > c_0\)或\(W^- < c_1\)
##### ②当\(W^+ < W^-时\)
同理可得拒绝域：\(W^+ < c_1\)或\(W^- > c_0\)

因此，我们可以得到：
- 在双边检测的情况下，若令\(T = min(W^+, W^-)\)，那么拒绝域为\(T < c1\)；若令\(T = max(W^+, W^-)\)，那么拒绝域为\(T > c_0\)。事实上，Wilcoxon检验统计量正是\(min(W^+, W^-)\)。
- 如果是做左侧检验，即\(M_e < \theta\)，此时预期\(\theta\)左侧的数据更密，即\(W^- > W^+\)，拒绝域取\(W^+ > c_0\)或\(W^- < c_1\)。为了和双边检测统一，我们习惯上取\(W^- < c_1\)；
- 同理，右侧检验的拒绝域为\(W^+ < c_1\)

可以看到，无论是单边还是双边检测都共用了一个\(c_1\)。但两个\(c_1\)对应的\(\alpha\)是不同的。在实践中，Wilcoxon临界值表通常标注的是**双边检验的显著性水平**。也就是说，双边检测的\(c_1 = T_{\alpha}\)，单边检测的\(c_1 = T_{2\alpha}\)

在标准教科书中，由于\(W^+\)和\(W^-\)分布的对称性，只要推导出一方的分布性质，另一方的分布性质就可以轻易得到。我们习惯上选用\(W^+\)进行分布性质的推导。

#### (2) 正秩和反秩
沿用\(y_j = x_j - \theta\)。为简化\(W^+\)的表达式，我们定义如下符号：
正秩：\(R_j^+ = R(|y_j|)\)
反向索引函数(反秩)：\(D(x)\)，满足\(D(R_j^+)= j\)


因此，\(R_j^+ = j\)的数是否为正数：\(W_j = I(y_{D(j)} > 0)\)
于是，我们的Wilcoxon符号检验量就可以表述成：
\[W^+ = \sum_{j=1}^n R_j^+ \cdot I(y_j > 0) = \sum_{j=1}^n j \cdot W_j\]
可以看到，引入反向索引函数后，\(W+\)的表达式变得更加简洁了。关于\(W^+\)的期望、方差以及概率分布，我们后续慢慢推导。


